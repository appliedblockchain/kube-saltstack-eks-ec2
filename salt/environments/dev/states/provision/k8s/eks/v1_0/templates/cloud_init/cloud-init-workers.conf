#This file is appended to the one generated by the module. No shebang instruction needed

useradd -m -s $(which bash) {{ username }}
echo '{{ username }} ALL=(ALL)NOPASSWD:ALL' | EDITOR='tee -a' visudo

mkdir /home/{{ username }}/.ssh
chown -R {{ username }}:{{ username }} /home/{{ username }}/.ssh
chmod 0700 /home/{{ username }}/.ssh
touch /home/{{ username }}/.ssh/authorized_keys
chmod 0600 /home/{{ username }}/.ssh/authorized_keys

echo "{{ public_key }} " > /home/{{ username }}/.ssh/authorized_keys
